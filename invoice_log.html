<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± â€” Rasha Adel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: url('background.jpg') center/cover fixed;
      font-family: 'Cairo', sans-serif;
    }
    .table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .table th, .table td { padding: 10px; border: 1px solid #ddd; background: #fff; text-align:center; }
    .table th { background-color:#f8f8f8; }
    .table tr:nth-child(even) { background-color:#f2f2f2; }
    .table tr:hover { background-color:#e6f7ff; }
    .footer-line { text-align:center; color:#a08a7a; margin-top:30px; }
    .search-bar { margin:20px 0; text-align:center; }
    .search-bar input[type="text"], .search-bar input[type="date"], .search-bar select {
      padding:10px; width:200px; border:1px solid #ccc; border-radius:5px; margin-left:10px;
    }
    .panel { overflow-x:auto; }
    button { background:#e74c3c; color:white; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; font-size:13px; }
    button:hover { background:#c0392b; }
    .export-buttons { text-align:center; margin-top:10px; }
    .export-buttons button { background:#3498db; margin:0 5px; }
    .export-buttons button:hover { background:#2980b9; }
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="brand">
    <img src="logo11.jpg" alt="Rasha Adel">
    <h1>Rasha Adel</h1>
    <p class="sub">Beauty Centre & Spa</p>
  </div>
  <nav class="nav">
    <a class="nav-item" href="dashboard_admin.html">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a>
    <a class="nav-item" href="clients.html">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
    <a class="nav-item" href="invoice_admin.html">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</a>
    <a class="nav-item active" href="invoice_log.html">Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</a>
    <a class="nav-item" href="services.html">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
    <a class="nav-item" href="profits.html">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</a>
    <a class="nav-item" href="register_customer_admin.html">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„</a>
    <a class="nav-item" href="index.html">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
  </nav>
</aside>

<main class="main">
  <div class="container">
    <h2>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>

    <div class="search-bar">
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…ØªØ®ØµØµØ© Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…" oninput="renderInvoices()">
        <input type="date" id="dateInput" onchange="renderInvoices()">
        <select id="monthFilter" onchange="renderInvoices()">
          <option value="">ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±</option>
          <option value="0">ÙŠÙ†Ø§ÙŠØ±</option>
          <option value="1">ÙØ¨Ø±Ø§ÙŠØ±</option>
          <option value="2">Ù…Ø§Ø±Ø³</option>
          <option value="3">Ø£Ø¨Ø±ÙŠÙ„</option>
          <option value="4">Ù…Ø§ÙŠÙˆ</option>
          <option value="5">ÙŠÙˆÙ†ÙŠÙˆ</option>
          <option value="6">ÙŠÙˆÙ„ÙŠÙˆ</option>
          <option value="7">Ø£ØºØ³Ø·Ø³</option>
          <option value="8">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
          <option value="9">Ø£ÙƒØªÙˆØ¨Ø±</option>
          <option value="10">Ù†ÙˆÙÙ…Ø¨Ø±</option>
          <option value="11">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
      </div>
    </div>

    <div class="export-buttons">
      <button onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
    </div>

    <div class="panel" id="invoicesList"></div>

    <div class="footer-line">Â© 2025 Rasha Adel Beauty Center & Spa â€“ Designed & Developed by Mohamed Ali</div>
  </div>
</main>

<script src="app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
function renderInvoices(){
  const invoices = window.app.getInvoices() || [];
  const container = document.getElementById('invoicesList');
  const searchValue = document.getElementById('searchInput').value.trim().toLowerCase();
  const dateValue = document.getElementById('dateInput').value;
  const monthFilter = document.getElementById('monthFilter').value;

  let filtered = invoices.filter(inv=>{
    const clientName = (inv.client || '').toLowerCase();
    const specialist = (inv.specialist || '').toLowerCase();
    const total = inv.final || 0;
    return !clientName.includes('ØªØ¬Ø±Ø¨') && !clientName.includes('test') && total > 0;
  });

  // ÙÙ„ØªØ± Ø§Ù„ÙŠÙˆÙ…
  if(dateValue){
    filtered = filtered.filter(inv => inv.date && inv.date.split('T')[0] === dateValue);
  }

  // ÙÙ„ØªØ± Ø§Ù„Ø´Ù‡Ø±
  if(monthFilter !== ""){
    filtered = filtered.filter(inv => inv.date && new Date(inv.date).getMonth() == monthFilter);
  }

  // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
  if(searchValue){
    filtered = filtered.filter(inv=>{
      const client = (inv.client || '').toLowerCase();
      const specialist = (inv.specialist || '').toLowerCase();
      const phone = (inv.phone || '').toLowerCase();
      return client.includes(searchValue) || specialist.includes(searchValue) || phone.includes(searchValue);
    });
  }

  if(filtered.length === 0){
    container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
    return;
  }

  container.innerHTML = `
    <table class="table" id="invoiceTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th>Ø§Ù„Ø®Ø¯Ù…Ø§Øª</th>
          <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…</th>
          <th>Ø§Ù„Ø®ØµÙ…</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody>
        ${filtered.map((inv,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>${inv.client || ''}</td>
            <td>${inv.services?.length ? inv.services.map(s=>`${s.name} Ã— ${s.qty}`).join('<br>') : 'â€”'}</td>
            <td>${inv.specialist || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>${inv.total_before || 0} Ø¬</td>
            <td>${inv.discount || 0} Ø¬</td>
            <td>${inv.final || 0} Ø¬</td>
            <td>${new Date(inv.date).toLocaleDateString('ar-EG')}</td>
            <td><button onclick="deleteInvoice(${inv.id}, '${inv.client || ''}')">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
}

function deleteInvoice(id,name){
  if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ "${name}"ØŸ`)) return;
  window.app.deleteInvoice(id);
  renderInvoices();
}

function exportToExcel(){
  const table = document.getElementById("invoiceTable");
  if(!table) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");
  const workbook = XLSX.utils.table_to_book(table,{sheet:"Invoices"});
  XLSX.writeFile(workbook,"Ø³Ø¬Ù„_Ø§Ù„ÙÙˆØ§ØªÙŠØ±.xlsx");
}

document.addEventListener('DOMContentLoaded', renderInvoices);
</script>
</body>
</html>
